# ðŸ“Š Diagrammes d'Architecture - DGI-NetWatch

## 1ï¸âƒ£ Architecture Globale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub Repository                        â”‚
â”‚  (Code source + Docker files + Terraform)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                â”‚                                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ GitHub      â”‚                            â”‚ GHCR         â”‚
         â”‚ Actions     â”‚ (Build images)             â”‚ (Registry)   â”‚
         â”‚ Pipeline    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ghcr.io/     â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                          â”‚
                â”‚ (Terraform apply)                        â”‚ (Pull images)
                â”‚                                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚          Google Cloud Platform (GCP)                     â”‚
        â”‚          Project: dgi-cosmic-20251210-1542              â”‚
        â”‚                                                          â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GKE Autopilot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚           Cluster: dgi-cluster                  â”‚   â”‚
        â”‚  â”‚           Region: us-central1                   â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Namespace: production â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
        â”‚  â”‚  â”‚                                            â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  Frontend Pod          Backend Pod         â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â”‚   nginx      â”‚      â”‚  Node.js     â”‚    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â”‚   :80        â”‚      â”‚  :3001       â”‚    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â”‚              â”‚      â”‚              â”‚    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â”‚ React App    â”‚      â”‚ server.js    â”‚    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚         â”‚                     â”‚             â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚                    â”‚                        â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚          ClusterIP Services                â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚   (Communication intra-cluster)            â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚                                            â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  Volumes:                                  â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚  - emptyDir (Backend: /app/db)            â”‚ â”‚   â”‚
        â”‚  â”‚  â”‚                                            â”‚ â”‚   â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â”‚  CoreDNS (Service Discovery)                  â”‚   â”‚
        â”‚  â”‚  - RÃ©sout: dgi-netwatch-backend.production   â”‚   â”‚
        â”‚  â”‚  - RÃ©sout: dgi-netwatch-frontend-service    â”‚   â”‚
        â”‚  â”‚                                                 â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚  Cloud Logging (Monitoring)                    â”‚    â”‚
        â”‚  â”‚  - Logs: tous les pods                         â”‚    â”‚
        â”‚  â”‚  - 50GB/mois gratuit                           â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚  GCS Bucket (Backup)                           â”‚    â”‚
        â”‚  â”‚  - 5GB gratuit/mois                            â”‚    â”‚
        â”‚  â”‚  - Future: BD backups                          â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Terraform State                     â”‚
        â”‚  (StockÃ©: GCS ou local .tfstate)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ Flux de DÃ©ploiement (CI/CD)

```
1. Developer
   â”‚
   â”œâ”€ git push main
   â”‚
   â–¼
2. GitHub Actions Workflow Trigger
   â”‚
   â”œâ”€ Step 1: Build Docker Images
   â”‚  â””â”€ docker build backend
   â”‚  â””â”€ docker build frontend
   â”‚
   â”œâ”€ Step 2: Push to GHCR
   â”‚  â””â”€ ghcr.io/tsramb23/dgi-netwatch-backend:latest
   â”‚  â””â”€ ghcr.io/tsramb23/dgi-netwatch-frontend:latest
   â”‚
   â”œâ”€ Step 3: Authenticate to GCP
   â”‚  â””â”€ GCP_SA_KEY (GitHub secret)
   â”‚
   â”œâ”€ Step 4: Setup gcloud
   â”‚  â””â”€ gcloud container clusters get-credentials
   â”‚  â””â”€ Install gke-gcloud-auth-plugin
   â”‚
   â”œâ”€ Step 5: Terraform Init
   â”‚  â””â”€ terraform init
   â”‚
   â”œâ”€ Step 6: Terraform Import (si besoin)
   â”‚  â””â”€ terraform import kubernetes_namespace.production
   â”‚
   â”œâ”€ Step 7: Terraform Plan
   â”‚  â””â”€ terraform plan -out=tfplan
   â”‚
   â”œâ”€ Step 8: Terraform Apply
   â”‚  â””â”€ terraform apply -auto-approve tfplan
   â”‚
   â–¼
3. Kubernetes Deployment
   â”‚
   â”œâ”€ Pull images from GHCR
   â”œâ”€ Create/Update pods
   â”œâ”€ Run health checks
   â”œâ”€ Rollout complete
   â”‚
   â–¼
4. Application Running
   â”‚
   â””â”€ Accessible via port-forward (dev)
   â””â”€ Accessible via Tunnel (future prod)
```

---

## 3ï¸âƒ£ Communication Inter-Pods

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Inside GKE Cluster (production)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend Pod                    Backend Pod
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  nginx:80          â”‚         â”‚  Node.js:3001      â”‚
â”‚                    â”‚         â”‚                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  React App     â”‚ â”‚         â”‚ â”‚  server.js     â”‚ â”‚
â”‚ â”‚                â”‚ â”‚         â”‚ â”‚  Endpoints:    â”‚ â”‚
â”‚ â”‚ API calls to:  â”‚ â”‚         â”‚ â”‚  /api/sante    â”‚ â”‚
â”‚ â”‚ http://        â”‚ â”‚         â”‚ â”‚  /api/...      â”‚ â”‚
â”‚ â”‚ dgi-netwatch-  â”‚ â”‚         â”‚ â”‚                â”‚ â”‚
â”‚ â”‚ backend:3001   â”‚ â”‚         â”‚ â”‚ BD:            â”‚ â”‚
â”‚ â”‚                â”‚ â”‚         â”‚ â”‚ /app/db/       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚ â”‚ surveillance   â”‚ â”‚
â”‚          â”‚          â”‚         â”‚ â”‚ .db (emptyDir) â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
           â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ DNS Resolution:
           â”‚ dgi-netwatch-backend â†’ 10.0.0.5
           â”‚ (CoreDNS Kubernetes)
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  ClusterIP Service (10.0.0.5:3001)       â”‚
           â”‚  Load balance to backend pods            â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â””â”€â–º Backend Pod responds on :3001
               TCP connection established
               HTTP response returned
```

---

## 4ï¸âƒ£ Networking & Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Networking                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External (Internet)
         â†‘
         â”‚ (BLOCKED - ClusterIP services)
         â”‚
         â”œâ”€â†’ âŒ No Public IP
         â”‚
         â”œâ”€â†’ âš ï¸ Future: Cloudflare Tunnel
         â”‚   https://app.yourdomain.com
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GKE Cluster Internal Network                   â”‚
â”‚                  (Pod CIDR: 10.0.0.0/14)                  â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  ClusterIP Services (Only accessible from inside)   â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â”‚  dgi-netwatch-frontend-service:80                   â”‚  â”‚
â”‚ â”‚  â””â”€ Endpoints: [frontend-pod-1]                     â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â”‚  dgi-netwatch-backend:3001                          â”‚  â”‚
â”‚ â”‚  â””â”€ Endpoints: [backend-pod-1]                      â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â”‚  CoreDNS (10.0.0.10:53)                             â”‚  â”‚
â”‚ â”‚  â””â”€ Zone: production.svc.cluster.local              â”‚  â”‚
â”‚ â”‚  â””â”€ Services auto-registered                        â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚  Pod-to-Pod Communication                           â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â”‚  Frontend (10.1.0.2) â”€â”                             â”‚  â”‚
â”‚ â”‚                       â”œâ”€â†’ Backend (10.1.0.3)        â”‚  â”‚
â”‚ â”‚                       â””â”€ DNS resolves name          â”‚  â”‚
â”‚ â”‚                                                      â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Local Developer Machine
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    kubectl port-forward                      â”‚
â”‚                                                              â”‚
â”‚ localhost:8080 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ localhost:3001 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â–º GKE Cluster   â”‚
â”‚                 (SSH Tunnel via API)  â”‚                     â”‚
â”‚                                       â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ Data Flow (Request Frontend â†’ Backend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User in Browser (http://localhost:8080)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  React App                                         â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  User Action (click button)                       â”‚    â”‚
â”‚  â”‚        â”‚                                           â”‚    â”‚
â”‚  â”‚        â–¼                                           â”‚    â”‚
â”‚  â”‚  fetch('/api/data')  OR  axios.get(...)          â”‚    â”‚
â”‚  â”‚        â”‚                                           â”‚    â”‚
â”‚  â”‚        â”‚ API_URL = http://localhost:3001          â”‚    â”‚
â”‚  â”‚        â”‚ (dev mode avec port-forward)             â”‚    â”‚
â”‚  â”‚        â”‚                                           â”‚    â”‚
â”‚  â”‚        â”‚ Production (future):                      â”‚    â”‚
â”‚  â”‚        â”‚ API_URL = http://dgi-netwatch-           â”‚    â”‚
â”‚  â”‚        â”‚            backend:3001                  â”‚    â”‚
â”‚  â”‚        â”‚ (from Frontend env var)                  â”‚    â”‚
â”‚  â”‚        â–¼                                           â”‚    â”‚
â”‚  â”‚  HTTP GET http://...                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginx (Frontend Pod)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Receive request on :80                         â”‚     â”‚
â”‚  â”‚  Serve static files (HTML/CSS/JS)               â”‚     â”‚
â”‚  â”‚  Or proxy to backend (if configured)            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Network (ClusterIP â†’ CoreDNS â†’ Backend Service)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. DNS resolves: dgi-netwatch-backend           â”‚     â”‚
â”‚  â”‚     â†’ 10.0.0.5 (ClusterIP)                       â”‚     â”‚
â”‚  â”‚  2. Route to backend service                     â”‚     â”‚
â”‚  â”‚  3. Load balance to backend pod (if replicas)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Backend Pod (Node.js:3001)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  server.js listening on :3001                   â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  Receive: GET /api/data                         â”‚     â”‚
â”‚  â”‚  Process: Query DB or compute                   â”‚     â”‚
â”‚  â”‚  Response: JSON 200 OK                          â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  DB Access:                                     â”‚     â”‚
â”‚  â”‚  /app/db/surveillance.db (emptyDir volume)      â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  Return: { data: "..." }                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Network Response Back                                    â”‚
â”‚  HTTP 200 {"data": "..."}                                â”‚
â”‚           â”‚                                                 â”‚
â”‚           â–¼                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Browser                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Receive JSON response                          â”‚    â”‚
â”‚  â”‚  Parse & render in React                        â”‚    â”‚
â”‚  â”‚  Update DOM                                     â”‚    â”‚
â”‚  â”‚  User sees data on page                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Latency: ~10-50ms (intra-cluster)
```

---

## 6ï¸âƒ£ Volumes & Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Pod Storage                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Backend Container
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  File System                           â”‚
â”‚                                        â”‚
â”‚  /app/                                 â”‚
â”‚  â”œâ”€ node_modules/                     â”‚
â”‚  â”œâ”€ server.js                         â”‚
â”‚  â”œâ”€ package.json                      â”‚
â”‚  â”‚                                     â”‚
â”‚  â””â”€ db/ â—„â”€â”€â”€â”                         â”‚
â”‚      â”‚       â”‚  (mounted volume)       â”‚
â”‚      â”œâ”€ surveillance.db               â”‚
â”‚      â””â”€ temp files                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  emptyDir       â”‚  (Ephemeral)
    â”‚  Volume         â”‚
    â”‚                 â”‚
    â”‚ Features:       â”‚
    â”‚ â€¢ Same node     â”‚  (This pod's node)
    â”‚ â€¢ Lost on       â”‚  (Pod restart)
    â”‚   deletion      â”‚  (Node failure)
    â”‚ â€¢ No backup     â”‚  (Future: implement)
    â”‚ â€¢ Max size: ?   â”‚  (Node disk limit)
    â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ Problem: Data lost when pod restarts
âœ… Solution (Future):
   â€¢ CronJob backup to GCS
   â€¢ Or: PersistentVolumeClaim (costs $$)
   â€¢ Or: External DB service
```

---

## 7ï¸âƒ£ Scaling Architecture (Future HPA)

```
Current (Fixed):
â””â”€ 1 replicas
   â””â”€ 1 pod always running
   â””â”€ Single point of failure

With HPA (Recommended):
â”œâ”€ Min replicas: 2 (always running)
â”‚  â”œâ”€ Pod 1 (10.0.0.2:3001)
â”‚  â””â”€ Pod 2 (10.0.0.3:3001)
â”‚
â”œâ”€ Max replicas: 3 (under load)
â”‚  â””â”€ Pod 3 (10.0.0.4:3001) [optional]
â”‚
â””â”€ Trigger: CPU > 70%
   â”‚
   â”œâ”€ When CPU > 70% â†’ Scale to 3
   â”œâ”€ When CPU < 30% â†’ Scale to 2
   â”‚
   â””â”€ ClusterIP Service
      â”œâ”€ Load balance across all pods
      â”œâ”€ Health checks maintain healthy pods
      â””â”€ Automatic rolling updates

Benefits:
âœ… Pod restart â†’ traffic shifts to others
âœ… Temporary surge â†’ auto-scales
âœ… Zero downtime deployments
```

---

## 8ï¸âƒ£ Security Model (Current & Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Current (Minimal)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Attacker                                         â”‚
â”‚         â”‚                                                  â”‚
â”‚         â”œâ”€â–º âŒ Cluster IP services (blocked)              â”‚
â”‚         â”œâ”€â–º âŒ No LoadBalancer (no public IP)              â”‚
â”‚         â”œâ”€â–º âš ï¸ If Tunnel active: might reach app          â”‚
â”‚         â”‚                                                  â”‚
â”‚  GCP Security:                                             â”‚
â”‚  â€¢ Firewall rules: restrictive                             â”‚
â”‚  â€¢ Service Account: limited permissions                    â”‚
â”‚  â€¢ API keys: none exposed                                  â”‚
â”‚                                                            â”‚
â”‚  Pod Security:                                             â”‚
â”‚  â€¢ No special privileges                                   â”‚
â”‚  â€¢ No root (default)                                       â”‚
â”‚  â€¢ Read-only filesystem (recommended)                      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Future (Production-Ready)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Attacker                                         â”‚
â”‚         â”‚                                                  â”‚
â”‚         â”œâ”€â–º Cloudflare Tunnel â†’ Rate limiting â†’ App       â”‚
â”‚         â”‚                                                  â”‚
â”‚  Internal Pod-to-Pod:                                      â”‚
â”‚  â”œâ”€â–º NetworkPolicy: Frontendâ†’Backend only                 â”‚
â”‚  â”œâ”€â–º âŒ Backendâ†’Frontend: blocked                          â”‚
â”‚  â”œâ”€â–º âŒ Podâ†’Pod random: blocked                            â”‚
â”‚  â”‚                                                         â”‚
â”‚  Secrets:                                                  â”‚
â”‚  â”œâ”€â–º External Secrets Operator                            â”‚
â”‚  â”œâ”€â–º GCP Secret Manager (encrypted)                       â”‚
â”‚  â”œâ”€â–º âŒ Plaintext secrets (never)                          â”‚
â”‚  â”‚                                                         â”‚
â”‚  API Security:                                             â”‚
â”‚  â”œâ”€â–º Rate limiting (Cloudflare)                           â”‚
â”‚  â”œâ”€â–º Authentication (if needed)                           â”‚
â”‚  â”œâ”€â–º Input validation                                     â”‚
â”‚  â”‚                                                         â”‚
â”‚  Data:                                                     â”‚
â”‚  â”œâ”€â–º HTTPS/TLS (Cloudflare + Let's Encrypt)              â”‚
â”‚  â”œâ”€â–º Database backups encrypted                           â”‚
â”‚  â”œâ”€â–º Access logs in Cloud Logging                         â”‚
â”‚  â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9ï¸âƒ£ Deployment Timeline

```
t=0s: Push code to GitHub
     â”‚
     â”œâ”€ GitHub Actions triggers
     â”‚
     â”œâ”€ Build Docker images (30-60s)
     â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 50%
     â”‚
     â”œâ”€ Push to GHCR (20-30s)
     â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 90%
     â”‚
     â”œâ”€ GCP Auth (5s)
     â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100%
     â”‚
     â”œâ”€ Terraform Plan (10-15s)
     â”‚  â””â”€ Plan created
     â”‚
     â”œâ”€ Kubernetes creates deployment (5-10s)
     â”‚  â””â”€ Deployment spec applied
     â”‚
     â”œâ”€ Kubernetes pulls images (30-60s)
     â”‚  â””â”€ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] Pulling...
     â”‚
     â”œâ”€ Pod starts (5-10s)
     â”‚  â””â”€ Container initializing
     â”‚
     â”œâ”€ Health checks (5-15s)
     â”‚  â””â”€ Liveness: TCP:3001 âœ…
     â”‚  â””â”€ Readiness: TCP:3001 âœ…
     â”‚
     â””â”€ Pod "Running" status âœ…
        Total: 2-3 minutes
        
        New pod is now serving traffic!
```

---

**LÃ©gende:**
- ðŸ”´ Critique
- ðŸŸ¡ Haute PrioritÃ©
- ðŸŸ¢ Moyenne
- ðŸ”µ Basse
- âœ… Fonctionnant
- âš ï¸ Ã€ surveiller
- âŒ Ã€ Ã©viter/BloquÃ©
